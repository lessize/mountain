<!DOCTYPE html>
<html lang="ko"
      xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>회원 가입</title>
  <style>
    * {
      margin:0; padding:0; list-style: none; text-decoration: none; box-sizing: border-box;
    }
  </style>
</head>
<body>
<div>
  <h3>회원가입</h3>
  <div></div>
  <form class="frm" id="signupForm" method="POST" action="/members/join">
    <ul class="mem_info">
      <li>
        <div>
          <label for="id">아이디</label><input type="email" name="id" id="id" placeholder="이메일 입력">
        </div>
      </li>
      <li>
        <div>
          <label for="id_chk">인증번호</label><input type="text" name="id_chk" id="id_chk"><button type="button">인증하기</button>
        </div>
      </li>
      <li>
        <div>
          <label for="pw">비밀번호</label><input type="password" name="pw" id="pw" placeholder="비밀번호 입력(영문,숫자,특수문자 포함 8~20자)">
        </div>
      </li>
      <li>
        <div>
          <label for="pw_chk">비밀번호 확인</label><input type="password" name="pw_chkid" id="pw_chk" placeholder="비밀번호 재입력"><span>비밀번호가 일치하지 않습니다</span>
        </div>
      </li>
      <li>
        <div>
          <label for="nickname">닉네임</label><input type="text" name="nickname" id="nickname" placeholder="닉네임 입력(1~10)"><button type="button">중복확인</button>
        </div>
      </li>
      <li>
        <div>
          <label for="tel">연락처</label><input type="text" name="tel" id="tel"  placeholder="휴대폰 번호 입력('-' 포함)">
        </div>
      </li>
      <li>
        <div>
          <label>성별</label>
          <input type="radio" name="gender" id="male" value="남자">
          <label for="male">남자</label>
          <input type="radio" name="gender" id="female" value="여자">
          <label for="female">여자</label>
        </div>
      </li>
      <li>
        <div>
          <label for="mexp">등산 경험</label>
          <select id="mexp" name="mexp">
            <option value="0">초급</option>
            <option value="1">중급</option>
            <option value="2">고급</option>
          </select>
        </div>
      </li>
      <li>
        <div>
          <label for="loc">지역</label>
          <select id="loc" name="loc">
            <option value="서울특별시">서울특별시</option>
            <option value="부산광역시">부산광역시</option>
            <option value="대구광역시">대구광역시</option>
            <option value="인천광역시">인천광역시</option>
            <option value="광주광역시">광주광역시</option>
            <option value="대전광역시">대전광역시</option>
            <option value="울산광역시">울산광역시</option>
            <option value="세종특별자치시">세종특별자치시</option>
            <option value="경기도">경기도</option>
            <option value="충청북도">충청북도</option>
            <option value="충청남도">충청남도</option>
            <option value="강원특별자치도">강원특별자치도</option>
            <option value="경상북도">경상북도</option>
            <option value="경상남도">경상남도</option>
            <option value="전북특별자치도">전북특별자치도</option>
            <option value="전라남도">전라남도</option>
            <option value="제주특별자치도">제주특별자치도</option>
          </select>
        </div>
      </li>
      <li>
        <div>
          <label for="contract">회원가입 약관</label>
          <textarea name="contract" id="contract"></textarea><input type="checkbox" name="agree" id="agree">동의
          <button type="submit">회원가입</button>
        </div>
      </li>
    </ul>
  </form>
</div>

<script>
  document.getElementById('signupForm').addEventListener('submit', function(event) {
    event.preventDefault();

    const form = event.target;
    const formData = new FormData(form);

    // 필요한 필드만 추출
    const partialData = {
      id: formData.get('id'),          // 이메일
      pw: formData.get('pw'),            // 비밀번호
      nickname: formData.get('nickname'),// 닉네임
      tel: formData.get('tel'),          // 전화번호
      gender: formData.get('gender'),    // 성별
      mexp: formData.get('mexp'),         // 등산 경험
      loc: formData.get('loc')        // 지역
    };

    console.log(partialData);

    // Fetch API를 사용하여 AJAX 요청 보내기
    fetch('/members/join', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json'
      },
      body: JSON.stringify(partialData)
    })
    .then(response => {
      if (response.ok) {
        // 회원가입 성공시 로그인 페이지로 리디렉션
        window.location.href = '/members/login';
      } else {
        // 회원가입 실패시 메인 페이지로 리디렉션
        window.location.href = '/';
      }
    })
    .catch(error => {
      console.error('Error:', error);
    });
  });
</script>
</body>
</html>
